<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Broadcast Contacts Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<style>

:root{
--primary:#4f46e5;
--secondary:#06b6d4;
--white:#ffffff;
--text:#111827;
}

/* BODY */

body{

font-family:Poppins;
margin:0;

background:linear-gradient(135deg,#4f46e5,#06b6d4);

min-height:100vh;
padding:20px;

}

/* HEADER */

.header{

text-align:center;
color:white;
font-size:32px;
font-weight:600;
margin-bottom:20px;

}

/* CONTAINER */

.container{

background:#ffffff;

border-radius:16px;

padding:20px;

box-shadow:0 10px 30px rgba(0,0,0,0.2);

max-width:1400px;
margin:auto;

}

/* FILTER GRID */

.filters{

display:grid;

grid-template-columns:repeat(auto-fit,minmax(220px,1fr));

gap:12px;

margin-bottom:15px;

}

/* INPUTS */

select,
input[type="date"]{

width:100%;

padding:10px;

border-radius:10px;

border:1px solid #ddd;

font-family:Poppins;

}

/* SELECT2 FIX */

.select2-container .select2-selection--multiple{

min-height:42px;

border-radius:10px !important;

}

/* BUTTONS */

.buttons{

margin-bottom:10px;

}

button{

padding:10px 18px;

border:none;

border-radius:10px;

cursor:pointer;

font-weight:500;

margin-right:10px;

transition:0.2s;

}

.btn-filter{

background:linear-gradient(90deg,var(--primary),var(--secondary));
color:white;

}

.btn-clear{

background:#64748b;
color:white;

}

/* RECORD COUNT */

.record-count{

font-weight:600;
margin-bottom:10px;

}

/* TABLE WRAPPER */

.table-wrapper{

max-height:60vh;

overflow-y:auto;

border-radius:12px;

border:1px solid #ddd;

}

/* TABLE */

table{

width:100%;

border-collapse:collapse;

background:white;

}

/* HEADINGS */

thead{

background:linear-gradient(90deg,var(--primary),var(--secondary));

color:white;

position:sticky;
top:0;

}

th{

padding:12px;

text-align:center;

font-weight:600;

}

/* DATA CELLS */

td{

padding:12px;

text-align:center;

border-bottom:1px solid #eee;

color:var(--text);

}

/* ROW HOVER */

tbody tr:hover{

background:#f1f5f9;

}

/* ERROR */

.error{

background:#fecaca;

padding:10px;

border-radius:8px;

margin-bottom:10px;

display:none;

}

/* LOADING */

.loading{

padding:30px;
text-align:center;

}

/* MOBILE */

@media(max-width:768px){

.header{

font-size:24px;

}

.container{

padding:15px;

}

th, td{

font-size:13px;
padding:10px;

}

}

</style>

</head>

<body>

<div class="header">
📇 Broadcast Contacts Dashboard
</div>

<div class="container">

<div class="filters">

<select id="contactNameFilter" multiple></select>

<select id="headingFilter" multiple></select>

<select id="mobileNumberFilter" multiple></select>

<input type="date" id="dateFilter">

</div>

<div class="buttons">

<button class="btn-filter" onclick="applyFilters()">Apply Filters</button>

<button class="btn-clear" onclick="clearFilters()">Clear All</button>

</div>

<div id="errorMessage" class="error"></div>

<div id="recordCount" class="record-count"></div>

<div id="tableContainer" class="loading">
Loading contacts...
</div>

</div>

<script>

const API_BASE_URL = window.location.origin;

/* INIT */

$(document).ready(function(){

initSelect();

loadFilters();

loadContacts();

});

/* SELECT INIT */

function initSelect(){

$('#contactNameFilter').select2({
placeholder:"Contact Names",
width:'100%'
});

$('#headingFilter').select2({
placeholder:"Headings",
width:'100%'
});

$('#mobileNumberFilter').select2({
placeholder:"Mobile Numbers",
width:'100%'
});

}

/* LOAD FILTER OPTIONS */

async function loadFilters(){

try{

const res=await fetch(API_BASE_URL+"/filter-options");

const data=await res.json();

if(!data.contact_names) return;

data.contact_names.forEach(x=>
$('#contactNameFilter').append(new Option(x,x))
);

data.headings.forEach(x=>
$('#headingFilter').append(new Option(x,x))
);

data.mobile_numbers.forEach(x=>
$('#mobileNumberFilter').append(new Option(x,x))
);

}catch(e){

showError("Failed to load filters");

}

}

/* LOAD CONTACTS */

async function loadContacts(){

try{

const res=await fetch(API_BASE_URL+"/contacts");

const data=await res.json();

displayContacts(data);

}catch(e){

showError("Failed to fetch");

}

}

/* APPLY FILTER */

async function applyFilters(){

const params=new URLSearchParams();

($('#contactNameFilter').val()||[])
.forEach(x=>params.append("contact_names",x));

($('#headingFilter').val()||[])
.forEach(x=>params.append("headings",x));

($('#mobileNumberFilter').val()||[])
.forEach(x=>params.append("mobile_numbers",x));

const date=$("#dateFilter").val();

if(date)
params.append("created_date",date);

const res=await fetch(API_BASE_URL+"/contacts?"+params);

const data=await res.json();

displayContacts(data);

}

/* CLEAR */

function clearFilters(){

$('#contactNameFilter').val(null).trigger('change');

$('#headingFilter').val(null).trigger('change');

$('#mobileNumberFilter').val(null).trigger('change');

$('#dateFilter').val('');

loadContacts();

}

/* DISPLAY */

function displayContacts(data){

document.getElementById("recordCount").innerText=
"Total Records: "+data.length;

if(!data.length){

document.getElementById("tableContainer").innerHTML=
"No records found";

return;

}

let html='<div class="table-wrapper"><table>';

html+='<thead><tr>';

html+='<th>Name</th>';
html+='<th>Heading</th>';
html+='<th>Mobile</th>';
html+='<th>Date</th>';

html+='</tr></thead><tbody>';

data.forEach(x=>{

let date="";

if(x.CreatedAt){

const d=new Date(x.CreatedAt);

if(!isNaN(d))
date=d.toLocaleString("en-GB");

}

html+=`
<tr>
<td>${x.ContactName||""}</td>
<td>${x.Heading||""}</td>
<td>${x.MobilePhone||""}</td>
<td>${date}</td>
</tr>`;

});

html+='</tbody></table></div>';

document.getElementById("tableContainer").innerHTML=html;

}

/* ERROR */

function showError(msg){

const e=document.getElementById("errorMessage");

e.innerText=msg;

e.style.display="block";

}

</script>

</body>
</html>
