<!-- GIT TEST -->
<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Broadcast Contacts Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<style>

:root{
--primary:#4f46e5;
--secondary:#06b6d4;
--glass:rgba(255,255,255,0.15);
--border:rgba(255,255,255,0.25);
}

/* BODY */

body{
font-family:Poppins;
margin:0;
background:linear-gradient(135deg,#4f46e5,#06b6d4);
min-height:100vh;
padding:30px;
}

/* HEADER */

.header{
text-align:center;
color:white;
font-size:32px;
font-weight:600;
margin-bottom:20px;
}

/* CONTAINER */

.container{
background:var(--glass);
backdrop-filter:blur(16px);
border-radius:16px;
padding:25px;
box-shadow:0 20px 50px rgba(0,0,0,0.25);
border:1px solid var(--border);
}

/* FILTERS */

.filters{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
gap:15px;
margin-bottom:15px;
}

/* SELECT2 FIX */

.select2-container--default .select2-selection--multiple{
height:38px !important;
min-height:38px !important;
border-radius:10px !important;
border:none !important;
display:flex !important;
align-items:center !important;
padding:2px 8px !important;
}

/* DATE INPUT */

input[type="date"]{
height:38px;
padding:0 12px;
border-radius:10px;
border:none;
font-family:Poppins;
}

/* BUTTONS */

.buttons{
margin-bottom:10px;
}

button{
padding:8px 18px;
border:none;
border-radius:10px;
cursor:pointer;
font-weight:500;
margin-right:10px;
}

.btn-filter{
background:linear-gradient(90deg,var(--primary),var(--secondary));
color:white;
}

.btn-clear{
background:#64748b;
color:white;
}

/* RECORD COUNT */

.record-count{
color:white;
font-weight:500;
margin-bottom:10px;
}

/* TABLE WRAPPER */

.table-wrapper{
max-height:60vh;
overflow-y:auto;
overflow-x:auto;
border-radius:12px;
background:white;
padding-right:4px;
scrollbar-gutter:stable;
}

/* SCROLLBAR */

.table-wrapper::-webkit-scrollbar{
width:10px;
}

.table-wrapper::-webkit-scrollbar-track{
background:rgba(255,255,255,0.25);
border-radius:10px;
}

.table-wrapper::-webkit-scrollbar-thumb{
background:linear-gradient(var(--primary),var(--secondary));
border-radius:10px;
border:2px solid rgba(255,255,255,0.3);
}

.table-wrapper::-webkit-scrollbar-thumb:hover{
background:linear-gradient(var(--secondary),var(--primary));
}

/* TABLE */

table{
width:100%;
border-collapse:collapse;
table-layout:fixed;
background:white;
}

/* HEADER */

thead th{
position:sticky;
top:0;
z-index:2;
background:linear-gradient(90deg,var(--primary),var(--secondary));
color:white;
padding:10px;
text-align:center;
}

/* BODY */

tbody td{
padding:8px;
text-align:center;
border-bottom:1px solid #e5e7eb;
color:#111827;
}

/* HOVER */

tbody tr:hover{
background:#eef2ff;
}

/* ERROR */

.error{
background:#fecaca;
padding:10px;
border-radius:8px;
margin-bottom:10px;
display:none;
}

.loading{
color:white;
text-align:center;
padding:20px;
}

</style>

</head>

<body>

<div class="header">
📇 Broadcast Contacts Dashboard
</div>

<div class="container">

<div class="filters">

<select id="contactNameFilter" multiple></select>

<select id="headingFilter" multiple></select>

<select id="mobileNumberFilter" multiple></select>

<input type="date" id="dateFilter">

</div>

<div class="buttons">

<button class="btn-filter" onclick="applyFilters()">Apply Filters</button>

<button class="btn-clear" onclick="clearFilters()">Clear All</button>

</div>

<div id="errorMessage" class="error"></div>

<div id="recordCount" class="record-count"></div>

<div id="tableContainer" class="loading">
Loading contacts...
</div>

</div>

<script>

const API_BASE_URL = window.location.origin;

$(document).ready(function(){

$('#contactNameFilter').select2({placeholder:"Contact Names"});
$('#headingFilter').select2({placeholder:"Headings"});
$('#mobileNumberFilter').select2({placeholder:"Mobile Numbers"});

loadFilters();
loadContacts();

});

/* LOAD FILTER OPTIONS */

async function loadFilters(){

try{

const res=await fetch(API_BASE_URL+"/filter-options");
const data=await res.json();

if(!data.contact_names) return;

data.contact_names.forEach(x=>
$('#contactNameFilter').append(new Option(x,x))
);

data.headings.forEach(x=>
$('#headingFilter').append(new Option(x,x))
);

data.mobile_numbers.forEach(x=>
$('#mobileNumberFilter').append(new Option(x,x))
);

}catch(e){

showError(e.message);

}

}

/* LOAD CONTACTS */

async function loadContacts(){

try{

const res=await fetch(API_BASE_URL+"/contacts");
const data=await res.json();

displayContacts(data);

}catch(e){

showError(e.message);

}

}

/* APPLY FILTER */

async function applyFilters(){

const params=new URLSearchParams();

($('#contactNameFilter').val()||[])
.forEach(x=>params.append("contact_names",x));

($('#headingFilter').val()||[])
.forEach(x=>params.append("headings",x));

($('#mobileNumberFilter').val()||[])
.forEach(x=>params.append("mobile_numbers",x));

const date=$("#dateFilter").val();

if(date)
params.append("created_date",date);

const res=await fetch(API_BASE_URL+"/contacts?"+params);
const data=await res.json();

displayContacts(data);

}

/* CLEAR FILTER */

function clearFilters(){

$('#contactNameFilter').val(null).trigger('change');
$('#headingFilter').val(null).trigger('change');
$('#mobileNumberFilter').val(null).trigger('change');
$('#dateFilter').val('');

loadContacts();

}

/* DISPLAY CONTACTS */

function displayContacts(data){

document.getElementById("recordCount").innerText=
"Total Records: "+data.length;

if(!data.length){

document.getElementById("tableContainer").innerHTML=
"No records found";

return;

}

let html=`<div class="table-wrapper"><table>`;

html+=`
<thead>
<tr>
<th>Name</th>
<th>Heading</th>
<th>Mobile</th>
<th>Date</th>
</tr>
</thead>
<tbody>`;

data.forEach(x=>{

let date="";

if(x.CreatedAt){

const d=new Date(x.CreatedAt);

if(!isNaN(d))
date=d.toLocaleString("en-GB");

}

html+=`
<tr>
<td>${x.ContactName||""}</td>
<td>${x.Heading||""}</td>
<td>${x.MobilePhone||""}</td>
<td>${date}</td>
</tr>`;

});

html+=`</tbody></table></div>`;

document.getElementById("tableContainer").innerHTML=html;

}

/* ERROR */

function showError(msg){

const e=document.getElementById("errorMessage");

e.innerText=msg;
e.style.display="block";

}

</script>

</body>

</html>
